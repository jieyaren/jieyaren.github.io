---
layout: post
title: 一个中间数据结构 apache arrow
categories: [database]
tags: [arrow]
---

每种数据库都有自己的结构，每种数据库之间的导入导出都需要convert

解决方案就是用通用的中间模型来表达，省掉转换的代价，也就是arrow的由来

<!-- more -->

### 

<img src="https://wanghenshui.github.io/assets/row-col.png" alt=""  width="100%">

```go
type FixedColumn struct {
  data       []byte
  length     int
  nullCount  int
  nullBitmap []byte // bit 0 is null, 1 is not null
}

type VarColumn struct {
  data       []byte
  offsets    []int64
  length     int
  nullCount  int
  nullBitmap []byte // bit 0 is null, 1 is not null
}
```



同是列式，Cassandra的格式是类似的https://github.com/facebook/rocksdb/blob/master/utilities/cassandra/format.h

```
length: 5, nullCount: 1
nullBitmap:
|Byte 0 (null bitmap) | Bytes 1-63            |
|---------------------|-----------------------|
| 00011101            | 0 (padding)           |
data:
|Bytes 0-3   | Bytes 4-7   | Bytes 8-11  | Bytes 12-15 | Bytes 16-19 | Bytes 20-63 |
|------------|-------------|-------------|-------------|-------------|-------------|
| 1          | unspecified | 2           | 4           | 8     
```



tidb使用类似的结构

https://zhuanlan.zhihu.com/p/38095421



### 参考

- https://www.infoq.cn/article/1m21n9lzek5qu2jysuue

---

看到这里或许你有建议或者疑问或者指出我的错误，请留言评论或者邮件mailto:wanghenshui@qq.com, 多谢! 
<details>
<summary>觉得写的不错可以点开扫码赞助几毛</summary>
<img src="https://wanghenshui.github.io/assets/wepay.png" alt="微信转账">
</details>